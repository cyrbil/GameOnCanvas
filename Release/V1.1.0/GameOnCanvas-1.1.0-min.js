var GOC={game:function(a,b,c,d){console.log("Log: Game Instancied");GOC.game.prototype.construct=function(a){console.log("Log: Constructor: Params to parse:",a);for(var b in a){switch(b){case"div":if(typeof a[b]=="HTMLDivElement")this.div=a[b];break;case"fps":if(1*a[b]>0)this.fps=a[b];break;case"ressources":if(typeof a[b]=="object")this.ressources=a[b];break;case"r":if(typeof a[b]=="object")this.ressources=a[b];break;case"canvas_inner":if(typeof a[b]=="string")this.canvas_inner=a[b];break;case"scene":if(typeof a[b]=="object")this.scene=a[b];break;case"debug":if(typeof a[b]=="boolean")this.debug=a[b];break;case"main":if(typeof a[b]=="function")this.main=a[b];break;case"antialiasing":if(1*a[b]>1)this.antialiasing=a[b];break;case"a":if(1*a[b]>1)this.antialiasing=a[b];break;case"canvas_rect":if(typeof a[b]=="object")this.canvas_rect=a[b];break;case"r":if(typeof a[b]=="object")this.canvas_rect=a[b];break;case"ie_support":if(typeof a[b]=="boolean")this.ie_support=a[b];break}}if(a.w*1>0||a.width*1>0)this.canvas_rect.width=a.w||a.width;if(a.h*1>0||a.height*1>0)this.canvas_rect.height=a.h||a.height};GOC.game.prototype.canvas_rect=new GOC.rectangle(0,0,600,400);GOC.game.prototype.antialiasing=1;GOC.game.prototype.div=null;GOC.game.prototype.canvas=null;GOC.game.prototype.ctx=null;GOC.game.prototype.fps=30;GOC.game.prototype.ressources={};GOC.game.prototype.canvas_inner="Your web browser is to old to let you play. Please update or change it.";GOC.game.prototype.scene=null;GOC.game.prototype.debug=false;GOC.game.prototype.ie_support=false;if(a.constructor.name=="rectangle"){this.canvas_rect=a;if((typeof b=="number"||typeof b=="string")&&1*b>1)this.antialiasing=b;if(typeof c=="object")this.construct(c);else if(typeof b=="object")this.construct(b)}else if(typeof a=="number"||typeof a=="string"||typeof b=="number"||typeof b=="string"){this.canvas_rect.width=a*1>0?a*1:this.canvas_rect.width;this.canvas_rect.height=b*1>0?b*1:this.canvas_rect.height;if((typeof c=="number"||typeof c=="string")&&1*c>1)this.antialiasing=c;if(typeof d=="object")this.construct(d);else if(typeof c=="object")this.construct(c)}else if(typeof a=="object")this.construct(a);else console.log("Warn: No parameters precised, will use default parameters.");GOC.game.prototype.keyboard={shift:false,ctrl:false,alt:false,altG:false,code:null,ascii:null};GOC.game.prototype.mouse={left:false,middle:false,right:false,x:0,y:0};GOC.game.prototype.debug_fps=0;GOC.game.prototype.array_fps=[];GOC.game.prototype.width=0;GOC.game.prototype.height=0;GOC.game.prototype.version="V1.1.0 Release";GOC.game.prototype.main=function(){};GOC.game.prototype.init=function(){if(typeof this.div!="HTMLDivElement"){console.log("Warn: No game div precised, will use body instead.\nHint: Set game.div to correct div.");this.div=document.body;if(this.div==null)return console.log("Error: <body> not found !\nHint: Create basic html page with body balise or set game.div to correct div.")}if(!(this.canvas_rect.width>0))this.canvas_rect.width=600;if(!(this.canvas_rect.height>0))this.canvas_rect.height=400;console.log("Log: Making canvas with dim: "+this.canvas_rect.width+"x"+this.canvas_rect.height+", antialiasing: "+this.antialiasing);canvas=document.createElement("canvas");var a="GOC-"+(typeof this.name=="string"?this.name:Math.floor(Math.random()*9999999+1e6));canvas.setAttribute("id",a);canvas.setAttribute("width",this.canvas_rect.width*this.antialiasing+"px");canvas.setAttribute("height",this.canvas_rect.height*this.antialiasing+"px");this.width=this.canvas_rect.width*this.antialiasing;this.height=this.canvas_rect.height*this.antialiasing;canvas.style.width=this.canvas_rect.width+"px";canvas.style.height=this.canvas_rect.height+"px";canvas.innerHTML=this.canvas_inner;this.div.appendChild(canvas);this.canvas=document.getElementById(a);var b=this;window.onkeydown=function(a){b.events(a,b)};this.canvas.onmousemove=function(a){b.events(a,b)};this.canvas.onmousedown=function(a){b.events(a,b)};this.canvas.onmouseup=function(a){b.events(a,b)};if(this.ie_support&&/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var c=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.type="text/javascript";d.src="http://explorercanvas.googlecode.com/svn/trunk/excanvas.js";c.appendChild(d)}if(!this.canvas.getContext)return console.log("Error: This web browser does not support canvas.");this.ctx=this.canvas.getContext("2d");this.draw_credit();if(this.ressources!==null&&typeof this.ressources=="object"){for(var e in this.ressources){return this.load()}}console.log("Log: Start ticker");this.ticker()};GOC.game.prototype.load=function(a){if(typeof this.ressources!="object")return console.log("Warn: Bad ressources param, skipping load");if(a==null)a=2e3;var b={};var c=0;var d=0;this.load.loaded=function(b,c,d){if(b+a<(new Date).getTime()||c.img.complete){console.log("Element:",c," is loaded ? ",c.img.width>0);d.load.check(b,d);return c.loaded=c.img.width>0}setTimeout(function(a,b,c){c.load.loaded(a,b,c)},50,b,c,d)};this.load.check=function(f,g){c++;if(c==d||f+a<(new Date).getTime()){for(e in b){if(b[e].loaded!=true)console.log("Warn: Element '"+e+"' can not be loaded in time.",b[e])}console.log("Log: Start ticker");g.ticker()}};for(var e in this.ressources){if(typeof this.ressources[e]!="string"){console.log("Warn: Ressource '"+e+"' is not an url string:",this.ressources[e])}else{b[e]=new GOC.elem(this.ressources[e]);d++;this.load.loaded((new Date).getTime(),b[e],this)}}this.load.check()};GOC.game.prototype.ticker=function(a,b,c,d){if(a==null||b==null||c==null)return this.ticker((new Date).getTime(),(new Date).getTime(),0,this);if(this.error)return console.error("Error detect, ended game now !");if((new Date).getTime()-a<1e3/this.fps)return setTimeout(function(){d.ticker(a,b,c,d)},1);this.main();this.display();this.events();c++;if((new Date).getTime()>b+1e3){this.debug_fps=c;return setTimeout(function(){d.ticker((new Date).getTime(),(new Date).getTime(),0,d)},1)}return this.ticker((new Date).getTime(),b,c,d)};GOC.game.prototype.events=function(a,b){if(a==undefined){this.keyboard={shift:false,ctrl:false,alt:false,altG:false,code:null,ascii:null};return}var a=window.event||a;if(a.type=="keydown"){var c=a.charCode||a.keyCode||null;b.keyboard={shift:a.shiftKey,ctrl:a.ctrlKey,alt:a.altKey,altG:a.altGraphKey,code:c,ascii:String.fromCharCode(c)}}else if(a.type=="mousemove"||a.type=="mousedown"||a.type=="mouseup"){var d,e;if(a.pageX||a.pageY){d=a.pageX;e=a.pageY}else{d=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;e=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}if(a.type=="mousedown"){b.mouse={left:a.button==0,middle:a.button==1,right:a.button==2,x:d-canvas.offsetLeft,y:e-canvas.offsetTop}}else if(a.type=="mouseup"){b.mouse={left:b.mouse.left&&a.button==0?false:b.mouse.left,middle:b.mouse.middle&&a.button==1?false:b.mouse.middle,right:b.mouse.right&&a.button==2?false:b.mouse.right,x:d-canvas.offsetLeft,y:e-canvas.offsetTop}}}};GOC.game.prototype.display=function(){this.ctx.save();var a=this.canvas_rect.width*this.antialiasing;var b=this.canvas_rect.height*this.antialiasing;this.ctx.clearRect(0,0,a,b);this.draw_credit();this.scene.tick();this.scene.draw(this.ctx);if(this.debug){this.array_fps.push(this.debug_fps);this.ctx.fillStyle="rgba(80,80,80,0.5)";this.ctx.fillRect(a-200,0,b,100);while(this.array_fps.length>50)this.array_fps.shift();this.ctx.fillStyle="rgba(0,255,0,0.8)";for(var c=0;c<this.array_fps.length;c++){this.ctx.fillRect(a-this.array_fps.length*4+c*4,55-30*this.array_fps[c]/this.fps-3,4,30*this.array_fps[c]/this.fps+3)}this.ctx.font="14pt Verdana";this.ctx.fillStyle="rgba(255,255,255,0.8)";this.ctx.fillText("Debug:",a-196,17);this.ctx.fillText(this.debug_fps+"/"+this.fps+" FPS",a-50-13*((""+this.debug_fps).length+(""+this.fps).length),17);this.ctx.fillText("KS-"+(this.keyboard.shift?"T":"F")+",A-"+(this.keyboard.alt?"T":"F")+",C-"+(this.keyboard.ctrl?"T":"F")+',"'+(this.keyboard.code!=null?this.keyboard.code:"")+'"',a-196,72);this.ctx.fillText("L-"+(this.mouse.left?"T":"F")+",M-"+(this.mouse.middle?"T":"F")+",R-"+(this.mouse.right?"T":"F")+" "+this.mouse.x+"x"+this.mouse.y,a-196,92)}this.ctx.restore()};GOC.game.prototype.draw_credit=function(){this.ctx.fillStyle="rgba(0,0,0,1)";this.ctx.fillRect(0,0,this.canvas_rect.width*this.antialiasing,this.canvas_rect.height*this.antialiasing);this.ctx.font="14pt Verdana";this.ctx.fillStyle="#CCC";this.ctx.fillText("GameOnCanvas",15,30);this.ctx.fillText(this.version,15,55);this.ctx.fillText("Copyright Cyrbil 2011",15,80)};var e=this;window.onload=function(){e.init()}},rectangle:function(a,b,c,d){GOC.rectangle.prototype.width=c==undefined?0:c;GOC.rectangle.prototype.height=d==undefined?0:d;GOC.rectangle.prototype.left=a==undefined?0:a;GOC.rectangle.prototype.top=b==undefined?0:b;GOC.rectangle.prototype.w=function(){return this.width};GOC.rectangle.prototype.h=function(){return this.height};GOC.rectangle.prototype.x=function(){return this.left};GOC.rectangle.prototype.y=function(){return this.top}},elem:function(a){GOC.elem.prototype.img={complete:true};GOC.elem.prototype.loaded=false;GOC.elem.prototype.x=0;GOC.elem.prototype.y=0;GOC.elem.prototype.w=0;GOC.elem.prototype.y=0;GOC.elem.prototype.speed=0;GOC.elem.prototype.direction=0;GOC.elem.prototype.id="elem-"+Math.floor(Math.random()*1e16);GOC.elem.prototype.tick=function(){this.x+=Math.cos(this.direction*Math.PI/180)*this.speed;this.y+=Math.sin(this.direction*Math.PI/180)*this.speed};GOC.elem.prototype.draw=function(a){}},scene:function(){GOC.scene.prototype.elems=new Array;GOC.scene.prototype.count=0;GOC.scene.prototype.id="scene-"+Math.floor(Math.random()*1e10);GOC.scene.prototype.tick=function(){for(var a=0;a<this.elems.length;a++){this.elems[a].tick()}};GOC.scene.prototype.draw=function(a){for(var b=0;b<this.elems.length;b++){this.elems[b].draw(a)}};GOC.scene.prototype.add=function(a){this.count++;this.elems.push(a)};GOC.scene.prototype.del=function(a){alert("Exception: NotImplementedYet")}}}